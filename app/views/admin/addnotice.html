{extends file="main.html"}
{block name="title"}系统新增通知{/block}
{block name="cssjs"}
<script type="text/javascript" src="{#YXP_STATIC_DOMAIN#}/js/cp/jquery.js?v={#cssjs_version#}"></script>
<script type="text/javascript" src="{#YXP_STATIC_DOMAIN#}/js/cp/jquery-ui-1.10.3.custom.min.js?v={#cssjs_version#}"></script>
<script type="text/javascript" src="{#YXP_STATIC_DOMAIN#}/js/cp/jquery.validationEngine-zh_CN.js?v={#cssjs_version#}"></script>
<script type="text/javascript" src="{#YXP_STATIC_DOMAIN#}/js/cp/jquery.validationEngine.js?v={#cssjs_version#}"></script>
<link href="{#YXP_STATIC_DOMAIN#}/css/cp/validationEngine.jquery.css?v={#cssjs_version#}" rel="stylesheet" type="text/css" />
<style type="text/css">
</style>
{/block}
{block name="menu"}
{include file="admin/_sub_nav.html"}
{/block}
<script type="text/javascript">
window.onload=function(){
//play tr各行换行颜色JS-->
    var otab = document.getElementById('tab1');
    var thiscolor = '';
    for (var i = 0; i < otab.tBodies[0].rows.length; i++) {
      if (i % 2) {
        otab.tBodies[0].rows[i].style.background = '';
      }
      else {
        otab.tBodies[0].rows[i].style.background = '#f7f7f7';
      }
    }
//stop tr各行换行颜色JS-->
}
</script>
</head>
{block name="body"}

    <div id="mcentent" class="cf">
      <div class="fqleftBg">
      <!--系统通知左侧开始-->
      <div class="fqleft">
       <ul>
        <li><a href="/admin/notice/" >历史通知</a></li>
        <li>
          {if $opt eq 3 }
          <a href="" class="hover">
          消息详情
          </a>
          {else}
          <a href="/admin/notice/addnotice" class="hover">
          新增通知
          </a>
          {/if}
      </li>
       </ul>
      </div>
      <!--系统通知左侧结束-->
      <!--系统通知右侧侧开始-->
      <div class="fqright fqbox">
        {if $opt eq 3 }
           <div class="fqboxfh"><em>消息详情</em></div>
        {else}
           <div class="fqboxfh"><em>新增通知</em></div>
        {/if}
        <form action=""  method="post"  id="formfee">
           <input type="hidden" id="opt" name="opt" value="{$opt}">
           <input type="hidden" id="messageid" name="messageid" value="{if $messageid}{$messageid}{/if}">
         <p class="csnewtz">
          <span>标题：</span>
          <input type="text" name="title" style="width:470px" class=" fqvinm validate[required,maxSize[30]]" value="{if $info.title}{$info.title}{/if}" {if $opt eq 3}disabled="disabled"{/if} data-errormessage-value-missing="*请填写标题">
        </p>
        <p class="csnewtz csnewtz-hack">
          <span>内容：</span>
          <textarea style="width:470px;" class="fqvinm editbox validate[required,maxSize[200]]" name="content" wrap="on" {if $opt eq 3} disabled="disabled" {/if} data-errormessage-value-missing="*请填写内容">{if $info.content}{$info.content}{/if}</textarea>
         <br>
          {if $opt eq 1 }
            <input type="button"  onclick="send()" class="vm jb_ok buttonfalse" style="float:none" value="确定发布" />
            <input type="button"  onclick="cancel()" class="vm jb-cancel" value="取消" />
          {else if $opt eq 2}
            <input type="button"  onclick="send()" class="vm jb_ok buttonfalse" style="float:none" value="更新发布" />
            <input type="button"  onclick="cancel()" class="vm jb-cancel" value="取消" />
          {else}
            <input type="button" value="返回" class="vm jb_ok" style="float:none" onclick="window.location.href='/admin/notice/index'">
          {/if}
        </p>
      </form>
      </div>
      <!--系统通知右侧侧结束-->

    </div>
  </div>
<div class="clear"></div>
<div id="footer"></div>
<script type="text/javascript">
  $(document).ready(function() {
    $("#formfee").validationEngine({
      scroll: false,
      promptPosition: 'centerRight',
      maxErrorsPerField: 1,
      showOneMessage: true,
      addPromptClass: 'formError-noArrow formError-text'
    });
  });
  /**
   * 提交表单
   */
  function send(){
    if($("#formfee").validationEngine('validate')){
      $(".buttonfalse").attr("disabled",true);
      $.post("/admin/notice/sends/",$('#formfee').serializeArray(), function(data){
        $(".buttonfalse").attr("disabled",false);
         if(data>0)
         {
            var opt={$opt};
            if(opt==1){
               alert('添加通知成功');
             }else{
               alert('更新通知成功');
             }
            window.location.href='/admin/notice/index';
         }
         else
         {
			      var opt={$opt};
            if(opt==1){
               alert('添加通知失败');
             }else{
               alert('更新通知失败');
             }
            window.location.href='/admin/notice/index';
         }
      });
    }
  }
function cancel()
{
  window.location.href='/admin/notice';
}
</script>
{/block}
